<!DOCTYPE html>
<!-- Template Name: Clip-One - Responsive Admin Template build with Twitter Bootstrap 3.x Version: 1.3 Author: ClipTheme -->
<!--[if IE 8]><html class="ie8 no-js" lang="en"><![endif]-->
<!--[if IE 9]><html class="ie9 no-js" lang="en"><![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- start: HEAD -->

<head>
<title>Clip-One - Responsive Admin Template</title>
<!-- start: META -->
<meta charset="utf-8" />
<!--[if IE]><meta http-equiv='X-UA-Compatible' content="IE=edge,IE=9,IE=8,chrome=1" /><![endif]-->
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta content="" name="description" />
<meta content="" name="author" />
<!-- end: META -->
<!-- start: MAIN CSS -->
<link rel="stylesheet"
	href="${base.contextPath}/assets/plugins/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet"
	href="${base.contextPath}/assets/plugins/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="${base.contextPath}/assets/fonts/style.css">
<link rel="stylesheet" href="${base.contextPath}/assets/css/main.css">
<link rel="stylesheet"
	href="${base.contextPath}/assets/css/main-responsive.css">
<link rel="stylesheet"
	href="${base.contextPath}/assets/plugins/iCheck/skins/all.css">
<link rel="stylesheet"
	href="${base.contextPath}/assets/plugins/bootstrap-colorpalette/css/bootstrap-colorpalette.css">
<link rel="stylesheet"
	href="${base.contextPath}/assets/plugins/perfect-scrollbar/src/perfect-scrollbar.css">
<link rel="stylesheet"
	href="${base.contextPath}/assets/css/theme_light.css" type="text/css"
	id="skin_color">
<link rel="stylesheet" href="${base.contextPath}/assets/css/print.css"
	type="text/css" media="print" />
<!--[if IE 7]>
		<link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome-ie7.min.css">
		<![endif]-->
<!-- end: MAIN CSS -->
<!-- start: CSS REQUIRED FOR THIS PAGE ONLY -->
<link rel="stylesheet" type="text/css"
	href="${base.contextPath}/assets/plugins/select2/select2.css" />
<link rel="stylesheet"
	href="${base.contextPath}/assets/plugins/DataTables/media/css/DT_bootstrap.css" />
<!-- end: CSS REQUIRED FOR THIS PAGE ONLY -->
<link rel="shortcut icon" href="favicon.ico" />
</head>

<body>
	<div class="panel panel-default">

		<div class="panel-body">

			<form role="form" id="formDepartment" method="post">
				<div class="row">
					<div class="col-md-12">
						<div class="errorHandler alert alert-danger no-display">
							<i class="fa fa-times-sign"></i> You have some form errors.
							Please check below.
						</div>
						<div class="successHandler alert alert-success no-display">
							<i class="fa fa-ok"></i> Your form validation is successful!
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label class="control-label"> 上级部门<span
								class="symbol required"></span>
							</label>
							<div class="row">
								<div class="col-md-3">
									<select name="parent.id" id="parent" class="form-control">
										<option value="0"></option>
									</select>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label"> 部门<span
								class="symbol required"></span>
							</label> <input type="text" placeholder="输入部门" class="form-control"
								id="name" name="name">
						</div>
						<div class="form-group">
							<label class="control-label"> 描述<span
								class="symbol required"></span>
							</label> <input type="text" placeholder="输入描述内容" class="form-control"
								id="description" name="description">
						</div>
						<div class="row" style="margin-top: 60px;">
							<div class="col-md-4">
								<button class="btn btn-yellow btn-block" type="button" id="btn"
									id="editClick">
									添加 <i class="fa fa-arrow-circle-right"></i>
								</button>
							</div>
						</div>
						<input id="id" name="id" type="hidden" value="${id}">
			</form>
		</div>
	</div>
	<!-- end: FOOTER -->
	<!-- start: MAIN JAVASCRIPTS -->
	<!--[if lt IE 9]>
		<script src="assets/plugins/respond.min.js"></script>
		<script src="assets/plugins/excanvas.min.js"></script>
		<script type="text/javascript" src="assets/plugins/jquery/1.10.2/jquery.min.js"></script>
		<![endif]-->
	<!--[if gte IE 9]><!-->
	<script
		src="${base.contextPath}/assets/plugins/jquery/2.0.3/jquery.min.js"></script>
	<!--<![endif]-->
	<script
		src="${base.contextPath}/assets/plugins/jquery-ui/jquery-ui-1.10.2.custom.min.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/blockUI/jquery.blockUI.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/iCheck/jquery.icheck.min.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/perfect-scrollbar/src/jquery.mousewheel.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/perfect-scrollbar/src/perfect-scrollbar.js"></script>
	<script src="${base.contextPath}/assets/plugins/less/less-1.5.0.min.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/jquery-cookie/jquery.cookie.js"></script>
	<script
		src="${base.contextPath}/assets/plugins/bootstrap-colorpalette/js/bootstrap-colorpalette.js"></script>
	<script src="${base.contextPath}/assets/js/main.js"></script>
	<!-- end: MAIN JAVASCRIPTS -->
	<!-- start: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->
	<script type="text/javascript"
		src="${base.contextPath}/assets/plugins/select2/select2.min.js"></script>
	<script type="text/javascript"
		src="${base.contextPath}/assets/plugins/DataTables/media/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript"
		src="${base.contextPath}/assets/plugins/DataTables/media/js/DT_bootstrap.js"></script>
	<script src="${base.contextPath}/assets/js/table-data.js"></script>
	<!-- end: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->
	<script>
		$(document).ready(function() {
			Main.init();
			TableData.init();
			initDepartment();
		});
		$('#editClick').on(
				"click",
				function() {

					$.ajax({
						url : "${base.contextPath}/department/edit",
						type : 'post',
						data : $("#formDepartment").serialize(),
						cache : false,
						success : function(text) {
							if (text == -1) {
								alert('添加失败');
							} else {
								window.parent.location.reload();
								var index = parent.layer
										.getFrameIndex(window.name); //获取窗口索引
								parent.layer.close(index);
							}
						},
						error : function(jqXHR, textStatus, errorThrown) {
							if (400 == jqXHR.status || 403 == jqXHR.status
									|| 500 == jqXHR.status)
								return;
							var text = "操作失败，" + jqXHR.responseText;
							alert(text);
						}
					});
				});
		function initDepartment() {
			$.ajax({
				url : "${base.contextPath}/department/list",
				type : 'post',
				contentType : "application/json",
				cache : false,
				success : function(text) {
					for (var i = 0; i < text.length; i++) {
						if (null == text[i].parent) {
							initDepartmentSelect(i, text, 'parent');
						}
					}
					initParam();
				},
				error : function(jqXHR, textStatus, errorThrown) {
					if (400 == jqXHR.status || 403 == jqXHR.status
							|| 500 == jqXHR.status)
						return;
					var text = "操作失败，" + jqXHR.responseText;
					alert(text);
				}
			});
		}
		//初始化數據
		function initParam() {
			var state = '${state}';
			if (state == 'edit') {
				$('#btn').html("修改");
				$.ajax({
					url : "${base.contextPath}/department/find?id=" + '${id}',
					type : 'get',
					cache : false,
					success : function(text) {
						$('#name').val(text.name);
						$('#description').val(text.description);
						var value = $('#parent').val(text.parent.id);
					},
					error : function(jqXHR, textStatus, errorThrown) {
						if (400 == jqXHR.status || 403 == jqXHR.status
								|| 500 == jqXHR.status)
							return;
						var text = "操作失败，" + jqXHR.responseText;
						alert(text);
					}
				});
			}
		}
		function initDepartmentSelect(index, data, name) {
			flag = 0;
			for (var i = 0; i < data.length; i++) {
				if ((null != data[i].parent)
						&& (data[i].parent.id == data[index].id)) {
					flag = 1;
					viewOptGroup(name, data[index]);
					initDepartmentSelect(i, data, 'opt_' + data[index].id);

				}
			}
			if (flag <= 0) {
				viewOpt(name, data[index]);

			}
		}
		function viewOptGroup(id, data) {
			if ($('#opt_' + data.id).length > 0) {
				return;
			}
			$('#' + id)
					.append(
							'<optgroup value="'+data.id+'" id="'+'opt_'+data.id+'" label="'+data.name+'"></optgroup>');
			$('#' + 'opt_' + data.id).append(
					'<option value="'+data.id+'">' + data.name + '</option>');
		}
		function viewOpt(id, data) {
			if ($('#opt_' + data.id).length > 0) {
				return;
			}
			if (data.name != null) {
				$('#' + id).append(
						'<option value="'+data.id+'">' + data.name
								+ '</option>');
			}
		}
	</script>
</body>
<!-- end: BODY -->

</html>